<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - MaNae's Cuisine</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD"></script>
    <style>
        .checkout-container {
            max-width: 800px;
            margin: 8rem auto 3rem;
            background-color: white;
            padding: 3rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .checkout-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        .checkout-header h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 1rem;
        }
        .order-summary {
            background-color: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        .order-summary h2 {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 1.5rem;
        }
        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px dashed #ddd;
        }
        .order-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #2c3e50;
        }
        .customer-info {
            margin-bottom: 2rem;
        }
        .customer-info h2 {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 1.5rem;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        .form-row {
            display: flex;
            gap: 1rem;
        }
        .form-row .form-group {
            flex: 1;
        }
        .payment-section {
            margin-top: 2rem;
        }
        .payment-section h2 {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 1.5rem;
        }
        #paypal-button-container {
            margin-top: 2rem;
        }
        .back-button {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.3);
            margin-bottom: 2rem;
        }
        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(149, 165, 166, 0.4);
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <img src="images/manaes_cuisine_logo.png" alt="MaNae's Cuisine Logo">
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#about-us">About Us</a></li>
                <li><a href="index.html#our-services">Our Services</a></li>
                <li><a href="index.html#menus">Menus</a></li>
                <li><a href="index.html#contact-us">Contact Us</a></li>
                <li><a href="order_meals.html">Order Weekly Meals</a></li>
            </ul>
            <button>Book Your Event</button>
        </nav>
    </header>

    <div class="checkout-container">
        <button class="back-button" onclick="window.history.back()">‚Üê Back to Order</button>
        
        <div class="checkout-header">
            <h1>Checkout</h1>
            <p>Complete your order for MaNae's Cuisine weekly meals</p>
        </div>

        <div class="order-summary">
            <h2>Order Summary</h2>
            <div id="checkout-order-items">
                <!-- Order items will be populated here -->
            </div>
        </div>

        <div class="customer-info">
            <h2>Delivery Information</h2>
            <form id="customer-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">First Name *</label>
                        <input type="text" id="firstName" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name *</label>
                        <input type="text" id="lastName" name="lastName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number *</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="address">Delivery Address *</label>
                    <input type="text" id="address" name="address" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="city">City *</label>
                        <input type="text" id="city" name="city" required>
                    </div>
                    <div class="form-group">
                        <label for="state">State *</label>
                        <input type="text" id="state" name="state" required>
                    </div>
                    <div class="form-group">
                        <label for="zipCode">ZIP Code *</label>
                        <input type="text" id="zipCode" name="zipCode" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="deliveryNotes">Delivery Notes (Optional)</label>
                    <input type="text" id="deliveryNotes" name="deliveryNotes" placeholder="Special instructions for delivery">
                </div>
            </form>
        </div>

        <div class="payment-section">
            <h2>Payment</h2>
            <p>Complete your payment securely with PayPal</p>
            <div id="paypal-button-container"></div>
        </div>
    </div>

    <script>
        // Get order data from localStorage or URL parameters
        function getOrderData() {
            const urlParams = new URLSearchParams(window.location.search);
            const orderData = urlParams.get('order');
            if (orderData) {
                return JSON.parse(decodeURIComponent(orderData));
            }
            // Fallback to localStorage
            const storedOrder = localStorage.getItem('manaes_order');
            return storedOrder ? JSON.parse(storedOrder) : null;
        }

        // Display order summary
        function displayOrderSummary() {
            const orderData = getOrderData();
            const container = document.getElementById('checkout-order-items');
            
            if (!orderData || !orderData.items || orderData.items.length === 0) {
                container.innerHTML = '<p>No items in your order. <a href="order_meals.html">Return to menu</a></p>';
                return;
            }

            let html = '';
            let total = 0;

            orderData.items.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                html += `
                    <div class="order-item">
                        <span>${item.name} x ${item.quantity}</span>
                        <span>$${itemTotal.toFixed(2)}</span>
                    </div>
                `;
            });

            html += `
                <div class="order-item">
                    <span>Total</span>
                    <span>$${total.toFixed(2)}</span>
                </div>
            `;

            container.innerHTML = html;
            return total;
        }

        // Initialize PayPal
        function initializePayPal() {
            const total = displayOrderSummary();
            if (!total) return;

            paypal.Buttons({
                createOrder: function(data, actions) {
                    // Validate customer form
                    const form = document.getElementById('customer-form');
                    if (!form.checkValidity()) {
                        alert('Please fill in all required fields before proceeding with payment.');
                        return;
                    }

                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                value: total.toFixed(2)
                            },
                            description: 'MaNae\'s Cuisine Weekly Meals'
                        }]
                    });
                },
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(details) {
                        // Get customer information
                        const customerInfo = {
                            firstName: document.getElementById('firstName').value,
                            lastName: document.getElementById('lastName').value,
                            email: document.getElementById('email').value,
                            phone: document.getElementById('phone').value,
                            address: document.getElementById('address').value,
                            city: document.getElementById('city').value,
                            state: document.getElementById('state').value,
                            zipCode: document.getElementById('zipCode').value,
                            deliveryNotes: document.getElementById('deliveryNotes').value
                        };

                        // Store order details for confirmation
                        const orderConfirmation = {
                            paypalOrderId: data.orderID,
                            customerInfo: customerInfo,
                            orderData: getOrderData(),
                            paymentDetails: details,
                            orderDate: new Date().toISOString()
                        };

                        localStorage.setItem('manaes_order_confirmation', JSON.stringify(orderConfirmation));
                        
                        // Redirect to confirmation page
                        window.location.href = 'confirmation.html';
                    });
                },
                onError: function(err) {
                    console.error('PayPal error:', err);
                    alert('There was an error processing your payment. Please try again.');
                }
            }).render('#paypal-button-container');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            displayOrderSummary();
            
            // Note: In a real implementation, you would need to:
            // 1. Replace 'YOUR_PAYPAL_CLIENT_ID' with your actual PayPal client ID
            // 2. Set up proper server-side handling for order processing
            // 3. Implement proper error handling and validation
            
            // For demonstration purposes, we'll show a message instead of initializing PayPal
            const paypalContainer = document.getElementById('paypal-button-container');
            paypalContainer.innerHTML = `
                <div style="background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 1rem; border-radius: 5px; text-align: center;">
                    <h3>PayPal Integration Ready</h3>
                    <p>To complete the PayPal integration:</p>
                    <ol style="text-align: left; max-width: 400px; margin: 0 auto;">
                        <li>Sign up for a PayPal Developer account</li>
                        <li>Create a new app to get your Client ID</li>
                        <li>Replace 'YOUR_PAYPAL_CLIENT_ID' in the script tag</li>
                        <li>Uncomment the initializePayPal() call below</li>
                    </ol>
                    <p><strong>For demo purposes, this shows the integration structure.</strong></p>
                </div>
            `;
            
            // Uncomment this line when you have a real PayPal Client ID:
            // initializePayPal();
        });
    </script>
</body>
</html>

